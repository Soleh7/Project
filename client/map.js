// Создаем карту и устанавливаем начальные координаты и уровень масштабирования
var map = L.map('map').setView([56.838, 53.367], 14); // Уменьшили уровень масштабирования

// Добавляем слой карты
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '© OpenStreetMap'
}).addTo(map);

// Определяем улицы и дома
var streets = {
    "Садовая": {
        coordinates: [
            [56.79167789744446, 53.38284215572648],
            [56.7867964023117, 53.38284215572648],
            [56.78206373426247, 53.38266027031713]
        ],
        houses: [1, 1, 1] // Все дома активны
    },
    "Мира": {
        coordinates: [
            [56.78198900313693, 53.38247838490778],
            [56.78261807462487, 53.37623553881286],
            [56.78405740436429, 53.367957514805305]
        ],
        houses: [1, 1, 0] // Два дома активны, один неактивен
    },
    "Рябиновая": {
        coordinates: [
            [56.785253913546235, 53.37473188237868],
            [56.782869527763026, 53.37425704352548],
            [56.781083306769645, 53.37246848384508]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Калинина": {
        coordinates: [
            [56.782205, 53.379890],
            [56.788008, 53.379954],
            [56.794152, 53.380175]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Коммунальная": {
        coordinates: [
            [56.791766, 53.382760],
            [56.792848, 53.372603],
            [56.793881, 53.367589],
            [56.794445, 53.365765],
            [56.795614, 53.363866]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Чкалова": {
        coordinates: [
            [56.792251, 53.378128],
            [56.783202, 53.376887],
            [56.783182, 53.377808],
            [56.784166, 53.377798],
            [56.784191, 53.376914]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Речная": {
        coordinates: [
            [56.790080, 53.377777],
            [56.790062, 53.379944],
            [56.789921, 53.386156],
            [56.789239, 53.386132],
            [56.788952, 53.386529],
            [56.788208, 53.385936]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Прудовая": {
        coordinates: [
            [56.788157, 53.385737],
            [56.788112, 53.382879],
            [56.788011, 53.379945],
            [56.788203, 53.374720],
            [56.788805, 53.372808],
            [56.790480, 53.367213],
            [56.790668, 53.366841],
            [56.792946, 53.363004],
            [56.795193, 53.360131],
            [56.794815, 53.358475],
            [56.796004, 53.356323]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Октябрьская": {
        coordinates: [
            [56.794788, 53.376807],
            [56.793949, 53.376363],
            [56.792495, 53.375883],
            [56.791342, 53.375465],
            [56.788802, 53.372800],
            [56.784875, 53.368612],
            [56.780185, 53.363906],
            [56.780958, 53.361940],
            [56.780185, 53.363906],
            [56.779491, 53.363305],
            [56.778917, 53.363594]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Сосновая":{
        coordinates: [
            [56.779532, 53.363201],
            [56.780338, 53.360792]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Подлесная":{
        coordinates: [
            [56.778445, 53.362659],
            [56.779473, 53.359502]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Вишнёвая":{
        coordinates: [
            [56.777636, 53.361160],
            [56.778808, 53.357853]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Родниковая":{
        coordinates: [
            [56.776781, 53.360011],
            [56.778365, 53.355541]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Ольховая":{
        coordinates: [
            [56.775896, 53.358885],
            [56.777423, 53.354570]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Лесная":{
        coordinates: [
            [56.774994, 53.357893],
            [56.776546, 53.353353]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Пушкинская": {
        coordinates: [
            [56.786209, 53.372438],
            [56.787160, 53.373624],
            [56.786985, 53.378090],
            [56.787160, 53.373624],
            [56.788131, 53.374631]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Полевая": {
        coordinates: [
            [56.784411, 53.374543],
            [56.784411, 53.374543]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Школьная": {
        coordinates: [
            [56.785289, 53.374691],
            [56.785468, 53.371666]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Южная": {
        coordinates: [
            [56.785938, 53.376966],
            [56.786185, 53.372540]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Азина": {
        coordinates: [
            [56.784673, 53.383129],
            [56.784606, 53.387001],
            [56.783275, 53.387065]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Восточная": {
        coordinates: [
            [56.784833, 53.384608],
            [56.786346, 53.384659]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Покровская": {
        coordinates: [
            [56.783600, 53.369246],
            [56.779763, 53.365523]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Зелёная": {
        coordinates: [
            [56.783383, 53.370710],
            [56.780455, 53.368108]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Спортивная": {
        coordinates: [
            [56.783048, 53.372535],
            [56.780874, 53.370430]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Светлая": {
        coordinates: [
            [56.782593, 53.375752],
            [56.781148, 53.374565],
            [56.781912, 53.375198],
            [56.781532, 53.379042]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Пугачёвская": {
        coordinates: [
            [56.795201, 53.374455],
            [56.792856, 53.372570],
            [56.789771, 53.369544],
            [56.789824, 53.369115],
            [56.785379, 53.363064],
            [56.784314, 53.362316],
            [56.783733, 53.361308],
            [56.782581, 53.360063],
            [56.782099, 53.359913],
            [56.780423, 53.356726],
            [56.779812, 53.355171],
            [56.780272, 53.353662]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Первомайская": {
        coordinates: [
            [56.796108, 53.372003],
            [56.794558, 53.370653],
            [56.793432, 53.369720],
            [56.790634, 53.366922],
            [56.785920, 53.361220]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Юбилейная": {
        coordinates: [
            [56.794040, 53.366724],
            [56.786979, 53.356839],
            [56.787434, 53.357508],
            [56.787710, 53.353071],
            [56.787434, 53.357508],
            [56.785395, 53.362856]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Колхозная": {
        coordinates: [
            [56.801111, 53.363987],
            [56.802445, 53.363514],
            [56.803279, 53.364298],
            [56.803408, 53.365349],
            [56.801458, 53.367141],
            [56.800571, 53.368546],
            [56.797434, 53.368997],
            [56.796741, 53.368337],
            [56.795013, 53.369592],
            [56.794620, 53.370450]
        ],
        houses: [1, 1, 0] // Все дома неактивны
    },
    "Береговая": {
        coordinates: [
            [56.801277, 53.369255],
            [56.803562, 53.367556]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Гольянская улица": {
        coordinates: [
            [56.788008, 53.399526],
            [56.789165, 53.393529],
            [56.792085, 53.386347],
            [56.793084, 53.383055],
            [56.794496, 53.380835],
            [56.797074, 53.378857],
            [56.798653, 53.376535],
            [56.804162, 53.375102],
            [56.806932, 53.373693]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Ключевая": {
        coordinates: [
            [56.784136, 53.361751],
            [56.784798, 53.359653],
            [56.780341, 53.353440],
            [56.778971, 53.350546],
            [56.778753, 53.347203],
            [56.780192, 53.343522]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Короткая": {
        coordinates: [
            [56.778347, 53.344584],
            [56.783982, 53.352502],
            [56.785994, 53.355073]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Солнечная": {
        coordinates: [
            [56.783531, 53.357643],
            [56.785077, 53.353959],
            [56.786052, 53.351401]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Солнечный переулок": {
        coordinates: [
            [56.784446, 53.355198],
            [56.783100, 53.353385]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Строителей": {
        coordinates: [
            [56.782044, 53.355720],
            [56.783477, 53.352262],
            [56.784547, 53.349519]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Цветочная": {
        coordinates: [
            [56.786028, 53.351318],
            [56.779680, 53.342716],
            [56.778687, 53.342410]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Оранжевая": {
        coordinates: [
            [56.779500, 53.351744],
            [56.781013, 53.348239],
            [56.781911, 53.345736]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Новая": {
        coordinates: [
            [56.780406, 53.353337],
            [56.782908, 53.347253]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },

    "Арская": {
        coordinates: [
            [56.779458, 53.368142],
            [56.779370, 53.370084],
            [56.780146, 53.374075],
            [56.779998, 53.375294],
            [56.779828, 53.378942],
            [56.779634, 53.379650]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Рассветная": {
        coordinates: [
            [56.778843, 53.364543],
            [56.778818, 53.371204],
            [56.779134, 53.373101],
            [56.779758, 53.374163],
            [56.780705, 53.374193]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Звездная": {
        coordinates: [
            [56.777689, 53.364036],
            [56.777577, 53.371104]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Радужная": {
        coordinates: [
            [56.777288, 53.360992],
            [56.776364, 53.362985],
            [56.776341, 53.370664],
            [56.776652, 53.372126],
            [56.779013, 53.379416],
            [56.780130, 53.380039]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Майская": {
        coordinates: [
            [56.775294, 53.358607],
            [56.775100, 53.360473],
            [56.775024, 53.367544]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Божко": {
        coordinates: [
            [56.774083, 53.357115],
            [56.773901, 53.357823],
            [56.773726, 53.369327],
            [56.777658, 53.381755],
            [56.778351, 53.382485],
            [56.779639, 53.383300]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Соловьиная": {
        coordinates: [
            [56.772738, 53.355506],
            [56.772638, 53.356117],
            [56.772514, 53.370055],
            [56.776285, 53.382097]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Шурдымская": {
        coordinates: [
            [56.771420, 53.354713],
            [56.771237, 53.370339],
            [56.773350, 53.377043]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Раздольная": {
        coordinates: [
            [56.770223, 53.352589],
            [56.770090, 53.361156],
            [56.770219, 53.362111]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Берёзовая": {
        coordinates: [
            [56.770134, 53.353020],
            [56.768088, 53.351224],
            [56.768844, 53.356683],
            [56.769795, 53.363579],
            [56.769713, 53.370334],
            [56.770825, 53.373766]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Трубецкая": {
        coordinates: [
            [56.768865, 53.356544],
            [56.771410, 53.356673]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Уральская": {
        coordinates: [
            [56.775066, 53.360226],
            [56.771921, 53.359921],
            [56.769319, 53.359890]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Троицкая": {
        coordinates: [
            [56.778591, 53.364020],
            [56.769789, 53.363578]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "1 Сентября": {
        coordinates: [
            [56.778766, 53.367926],
            [56.775355, 53.367799],
            [56.773722, 53.367657],
            [56.769076, 53.367494]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Переулок 1 Сентября": {
        coordinates: [
            [56.774101, 53.370503],
            [56.770878, 53.373795]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Калиновая": {
        coordinates: [
            [56.778779, 53.371239],
            [56.777580, 53.371228],
            [56.773031, 53.375982],
            [56.772396, 53.376303]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Новосельская": {
        coordinates: [
            [56.779131, 53.373076],
            [56.774921, 53.377640]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Слободская": {
        coordinates: [
            [56.778411, 53.377709],
            [56.775890, 53.380541]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Ярославская": {
        coordinates: [
            [56.778161, 53.381620],
            [56.779883, 53.382253]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    },
    "Берёзовский переулок": {
        coordinates: [
            [56.771416, 53.373382],
            [56.772286, 53.376224]
        ],
        houses: [1, 1, 1] // Все дома неактивны
    }
};

// Добавляем улицы на карту
for (var streetName in streets) {
    var streetData = streets[streetName];
    var streetCoordinates = streetData.coordinates;
    var houses = streetData.houses;

    // Определяем цвет улицы
    var activeCount = houses.filter(house => house === 1).length;
    var inactiveCount = houses.filter(house => house === 0).length; // Количество неактивных домов
    var streetColor;

    if (activeCount === 3) {
        streetColor = 'green'; // Все дома активны
    } else if (activeCount === 2) {
        streetColor = 'yellow'; // Два дома активны
    } else {
        streetColor = 'red'; // Менее двух активных домов
    }

    // Создаем линию улицы на карте
    var streetLine = L.polyline(streetCoordinates, {color: streetColor, weight: 5}).addTo(map);
    streetLine.bindPopup(`${streetName}<br>Домов с проблемой: ${inactiveCount}`); // Название улицы и количество неактивных домов

    // Добавляем обработчики событий для изменения толщины улицы
    streetLine.on('mouseover', function(e) {
        this.setStyle({ weight: 7 }); // Увеличиваем толщину
    });

    streetLine.on('mouseout', function(e) {
        this.setStyle({ weight: 5 }); // Возвращаем исходную толщину
    });
}

// Центрируем карту по всем улицам
var allCoordinates = [].concat(...Object.values(streets).map(street => street.coordinates));
var bounds = L.latLngBounds(allCoordinates);
map.fitBounds(bounds);
